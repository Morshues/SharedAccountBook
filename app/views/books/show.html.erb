<%= t('book.name') %>
<%= @book.name %>
<br>
<%= t('book.owner') %>
<%= @book.owner.name %>
<hr>
<div class="table-responsive">
  <table class="table">
    <thead>
      <tr>
        <th><%= t('book.item.time') %></th>
        <th><%= t('book.item.title') %></th>
        <th><%= t('book.item.currenry') %></th>
        <th><%= t('book.item.price') %></th>
        <% members_arr = [] %>
        <% @book.user_memberships.each do |member| %>
          <th><%= member.name %></th>
          <% members_arr.push member.id %>
        <% end %>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% @book.items.includes(flows: :membership).each do |item| %>
        <tr>
          <td><%= item.time %></td>
          <td><%= item.title %></td>
          <td><%= item.currency %></td>
          <td>
            <%= item.price.abs %>
            <%= "(#{item.exchange_name})" if item.exchange_id.present? %>
          </td>
          <% members_arr.each do |member_id| %>
            <% flow_num = item.flows.find_by(membership_id: member_id)&.number || 0 %>
            <td>
              <%= flow_num&.abs %>
            </td>
          <% end %>
          <td><%= link_to 'â•³', delete_item_book_path(item_id: item.id), remote: true, method: :delete %></td>
        </tr>
      <% end %>
    </tbody>
    <tfoot>
      <tr>
        <th colspan="3"><%= t('book.summary') %></th>
        <th><%= @book.total_price %></th>
        <% @book.user_memberships.each do |member| %>
          <th><%= member.total_price %></th>
        <% end %>
      </tr>
    </tfoot>
  </table>
</div>
<hr>
  <%= render partial: 'create_block' %>
<hr>
<%= link_to t('edit'), edit_book_path(@book.token) %>
<%= link_to t('back_to_list'), books_path %>
